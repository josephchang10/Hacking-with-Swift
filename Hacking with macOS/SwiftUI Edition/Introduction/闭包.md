目前你已经见过整数、字符串、doubles、floats、布尔型、数组、字典、structs 和类了，但还有另一种类型的数据，在 Swift 中被广泛使用，而它被称为闭包（closure）。它们很复杂，但它们非常强大而且表达能力强，以至于 Swift 中到处都在使用它们，因此不理解它们，你就无法走得很远。

一个闭包可以被看作是一个存储代码的变量。因此，和一个整型存储“0”或“500”一样，一个闭包存储一些 Swift 代码。闭包还会捕获它们被创建时的环境，这意味着它们会拷贝在其内部使用的值。

你永远不*需要*设计你自己的闭包，因此如果你发现下面很复杂也别害怕。然而，Apple 的框架通常会要求你写闭包以满足它们的需求，因此你至少需要知道它们是如何工作的。

这是一个来自 SwiftUI 的例子：

```swift
let message = "按了按钮"

Button("按我", action: {
  print(message)
})
```

**Button（按钮）** 是我们在 SwiftUI 中拥有的众多用户界面控件之一，并允许用户在按下时执行某种操作。

在这段代码中，创建一个按钮有两个参数：一些将显示为该按钮标题的文本，以及一个闭包，它包含了在按钮被按下时会被执行的代码。我给这第一个参数指定了“按我”，而对于第二个我让系统打印了一条字符串消息。

这个方法需要使用一个闭包，因为除非该按钮被按下，否则 SwiftUI 不会运行这些代码——它会把这些操作代码存起来供以后使用，然后仅在需要时才调用它。如果我们直接运行我们的代码，这就不可能实现了。

上面的代码也展示了闭包是如何捕获它们的环境的：我有意在这个闭包外部声明的这个 **message** 常量，然后在内部使用它。Swift 检测到这一点，并让那个数据在该闭包内部也可用。

Swift 自动捕获一个闭包环境的系统是非常有帮助的，但偶尔也会让你你栽个跟头：如果对象 A 将一个闭包存储为一个属性，而那个属性也引用了对象 A，你就有了某种叫做循环引用（retain cycle）的东西，这会让用户不爽。这是一个远远更高级的话题，你目前不需要知道，所以暂时还不用太担心它。

## 尾随闭包
由于闭包使用得非常频繁，Swift 能够采用一点儿语法糖（syntactic sugar）来让你的代码更容易阅读。规则是这样的：如果一个方法最后面的参数们是闭包，你可以省略这个参数，并以大括号中的一块代码来提供它们，作为代替。例如，我们可以把之前的代码转化成这样：

```swift
let message = "按了按钮"

Button("按我") {
  print(message)
}
```

它确实让你的代码更短而且更容易阅读了，因此这种语法形式——被称作尾随闭包语法（trailing closure syntax）——是更推荐的。

如果需要的话，一个函数可以有多个尾随闭包，而这在 SwiftUI 中尤为常见。例如，创建一个按钮的方式之一是将按下（pressed）时运行的代码作为第一个闭包提供，然后是用于在屏幕上显示的、按钮内部的一些自定义的东西，像这样：

```swift
Button {
  print("这个按钮被按了")
} label: {
  Image("press-me")
}
```

这使用了一张图像而非一段简单的文本，但它可以是任何类型的 SwiftUI 用户界面控件（user interface control）。